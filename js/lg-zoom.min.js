/*! lg-zoom - v1.0.4 - 2016-12-20
* http://sachinchoolur.github.io/lightGallery
* Copyright (c) 2016 Sachin N; Licensed GPLv3 */
!function(o,e){"function"==typeof define&&define.amd?define(["jquery"],(function(o){return e(o)})):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(0,(function(o){!function(){"use strict";var e={scale:1,zoom:!0,actualSize:!0,enableZoomAfter:300,useLeftForZoom:function(){var o=!1,e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return e&&parseInt(e[2],10)<54&&(o=!0),o}()},t=function(t){return this.core=o(t).data("lightGallery"),this.core.s=o.extend({},e,this.core.s),this.core.s.zoom&&this.core.doCss()&&(this.init(),this.zoomabletimeout=!1,this.pageX=o(window).width()/2,this.pageY=o(window).height()/2+o(window).scrollTop()),this};t.prototype.init=function(){var e=this,t='<span id="lg-zoom-in" class="lg-icon"></span><span id="lg-zoom-out" class="lg-icon"></span>';e.core.s.actualSize&&(t+='<span id="lg-actual-size" class="lg-icon"></span>'),e.core.s.useLeftForZoom?e.core.$outer.addClass("lg-use-left-for-zoom"):e.core.$outer.addClass("lg-use-transition-for-zoom"),this.core.$outer.find(".lg-toolbar").append(t),e.core.$el.on("onSlideItemLoad.lg.tm.zoom",(function(t,a,r){var s=e.core.s.enableZoomAfter+r;o("body").hasClass("lg-from-hash")&&r?s=0:o("body").removeClass("lg-from-hash"),e.zoomabletimeout=setTimeout((function(){e.core.$slide.eq(a).addClass("lg-zoomable")}),s+30)}));var a=1,r=function(t){var a=e.core.$outer.find(".lg-current .lg-image"),r=(o(window).width()-a.prop("offsetWidth"))/2,s=(o(window).height()-a.prop("offsetHeight"))/2+o(window).scrollTop(),i=(t-1)*(e.pageX-r),n=(t-1)*(e.pageY-s);a.css("transform","scale3d("+t+", "+t+", 1)").attr("data-scale",t),e.core.s.useLeftForZoom?a.parent().css({left:-i+"px",top:-n+"px"}).attr("data-x",i).attr("data-y",n):a.parent().css("transform","translate3d(-"+i+"px, -"+n+"px, 0)").attr("data-x",i).attr("data-y",n)},s=function(){a>1?e.core.$outer.addClass("lg-zoomed"):e.resetZoom(),a<1&&(a=1),r(a)},i=function(t,r,i,n){var l,c=r.prop("offsetWidth");l=e.core.s.dynamic?e.core.s.dynamicEl[i].width||r[0].naturalWidth||c:e.core.$items.eq(i).attr("data-width")||r[0].naturalWidth||c,e.core.$outer.hasClass("lg-zoomed")?a=1:l>c&&(a=l/c||2),n?(e.pageX=o(window).width()/2,e.pageY=o(window).height()/2+o(window).scrollTop()):(e.pageX=t.pageX||t.originalEvent.targetTouches[0].pageX,e.pageY=t.pageY||t.originalEvent.targetTouches[0].pageY),s(),setTimeout((function(){e.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")}),10)},n=!1;e.core.$el.on("onAferAppendSlide.lg.tm.zoom",(function(o,t){var a=e.core.$slide.eq(t).find(".lg-image");a.on("dblclick",(function(o){i(o,a,t)})),a.on("touchstart",(function(o){n?(clearTimeout(n),n=null,i(o,a,t)):n=setTimeout((function(){n=null}),300),o.preventDefault()}))})),o(window).on("resize.lg.zoom scroll.lg.zoom orientationchange.lg.zoom",(function(){e.pageX=o(window).width()/2,e.pageY=o(window).height()/2+o(window).scrollTop(),r(a)})),o("#lg-zoom-out").on("click.lg",(function(){e.core.$outer.find(".lg-current .lg-image").length&&(a-=e.core.s.scale,s())})),o("#lg-zoom-in").on("click.lg",(function(){e.core.$outer.find(".lg-current .lg-image").length&&(a+=e.core.s.scale,s())})),o("#lg-actual-size").on("click.lg",(function(o){i(o,e.core.$slide.eq(e.core.index).find(".lg-image"),e.core.index,!0)})),e.core.$el.on("onBeforeSlide.lg.tm",(function(){a=1,e.resetZoom()})),e.core.isTouch||e.zoomDrag(),e.core.isTouch&&e.zoomSwipe()},t.prototype.resetZoom=function(){this.core.$outer.removeClass("lg-zoomed"),this.core.$slide.find(".lg-img-wrap").removeAttr("style data-x data-y"),this.core.$slide.find(".lg-image").removeAttr("style data-scale"),this.pageX=o(window).width()/2,this.pageY=o(window).height()/2+o(window).scrollTop()},t.prototype.zoomSwipe=function(){var o=this,e={},t={},a=!1,r=!1,s=!1;o.core.$slide.on("touchstart.lg",(function(t){if(o.core.$outer.hasClass("lg-zoomed")){var a=o.core.$slide.eq(o.core.index).find(".lg-object");s=a.prop("offsetHeight")*a.attr("data-scale")>o.core.$outer.find(".lg").height(),((r=a.prop("offsetWidth")*a.attr("data-scale")>o.core.$outer.find(".lg").width())||s)&&(t.preventDefault(),e={x:t.originalEvent.targetTouches[0].pageX,y:t.originalEvent.targetTouches[0].pageY})}})),o.core.$slide.on("touchmove.lg",(function(i){if(o.core.$outer.hasClass("lg-zoomed")){var n,l,c=o.core.$slide.eq(o.core.index).find(".lg-img-wrap");i.preventDefault(),a=!0,t={x:i.originalEvent.targetTouches[0].pageX,y:i.originalEvent.targetTouches[0].pageY},o.core.$outer.addClass("lg-zoom-dragging"),l=s?-Math.abs(c.attr("data-y"))+(t.y-e.y):-Math.abs(c.attr("data-y")),n=r?-Math.abs(c.attr("data-x"))+(t.x-e.x):-Math.abs(c.attr("data-x")),(Math.abs(t.x-e.x)>15||Math.abs(t.y-e.y)>15)&&(o.core.s.useLeftForZoom?c.css({left:n+"px",top:l+"px"}):c.css("transform","translate3d("+n+"px, "+l+"px, 0)"))}})),o.core.$slide.on("touchend.lg",(function(){o.core.$outer.hasClass("lg-zoomed")&&a&&(a=!1,o.core.$outer.removeClass("lg-zoom-dragging"),o.touchendZoom(e,t,r,s))}))},t.prototype.zoomDrag=function(){var e=this,t={},a={},r=!1,s=!1,i=!1,n=!1;e.core.$slide.on("mousedown.lg.zoom",(function(a){var s=e.core.$slide.eq(e.core.index).find(".lg-object");n=s.prop("offsetHeight")*s.attr("data-scale")>e.core.$outer.find(".lg").height(),i=s.prop("offsetWidth")*s.attr("data-scale")>e.core.$outer.find(".lg").width(),e.core.$outer.hasClass("lg-zoomed")&&o(a.target).hasClass("lg-object")&&(i||n)&&(a.preventDefault(),t={x:a.pageX,y:a.pageY},r=!0,e.core.$outer.scrollLeft+=1,e.core.$outer.scrollLeft-=1,e.core.$outer.removeClass("lg-grab").addClass("lg-grabbing"))})),o(window).on("mousemove.lg.zoom",(function(o){if(r){var l,c,d=e.core.$slide.eq(e.core.index).find(".lg-img-wrap");s=!0,a={x:o.pageX,y:o.pageY},e.core.$outer.addClass("lg-zoom-dragging"),c=n?-Math.abs(d.attr("data-y"))+(a.y-t.y):-Math.abs(d.attr("data-y")),l=i?-Math.abs(d.attr("data-x"))+(a.x-t.x):-Math.abs(d.attr("data-x")),e.core.s.useLeftForZoom?d.css({left:l+"px",top:c+"px"}):d.css("transform","translate3d("+l+"px, "+c+"px, 0)")}})),o(window).on("mouseup.lg.zoom",(function(o){r&&(r=!1,e.core.$outer.removeClass("lg-zoom-dragging"),!s||t.x===a.x&&t.y===a.y||(a={x:o.pageX,y:o.pageY},e.touchendZoom(t,a,i,n)),s=!1),e.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")}))},t.prototype.touchendZoom=function(o,e,t,a){var r=this,s=r.core.$slide.eq(r.core.index).find(".lg-img-wrap"),i=r.core.$slide.eq(r.core.index).find(".lg-object"),n=-Math.abs(s.attr("data-x"))+(e.x-o.x),l=-Math.abs(s.attr("data-y"))+(e.y-o.y),c=(r.core.$outer.find(".lg").height()-i.prop("offsetHeight"))/2,d=Math.abs(i.prop("offsetHeight")*Math.abs(i.attr("data-scale"))-r.core.$outer.find(".lg").height()+c),g=(r.core.$outer.find(".lg").width()-i.prop("offsetWidth"))/2,u=Math.abs(i.prop("offsetWidth")*Math.abs(i.attr("data-scale"))-r.core.$outer.find(".lg").width()+g);(Math.abs(e.x-o.x)>15||Math.abs(e.y-o.y)>15)&&(a&&(l<=-d?l=-d:l>=-c&&(l=-c)),t&&(n<=-u?n=-u:n>=-g&&(n=-g)),a?s.attr("data-y",Math.abs(l)):l=-Math.abs(s.attr("data-y")),t?s.attr("data-x",Math.abs(n)):n=-Math.abs(s.attr("data-x")),r.core.s.useLeftForZoom?s.css({left:n+"px",top:l+"px"}):s.css("transform","translate3d("+n+"px, "+l+"px, 0)"))},t.prototype.destroy=function(){var e=this;e.core.$el.off(".lg.zoom"),o(window).off(".lg.zoom"),e.core.$slide.off(".lg.zoom"),e.core.$el.off(".lg.tm.zoom"),e.resetZoom(),clearTimeout(e.zoomabletimeout),e.zoomabletimeout=!1},o.fn.lightGallery.modules.zoom=t}()}));